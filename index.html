<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">

<!-- åŸºæœ¬ SEO -->
<title>æ™ºæ…§åƒåœ¾åˆ†é¡ç³»çµ±ï½œSmart Trash AI</title>
<meta name="description" content="æ™ºæ…§åƒåœ¾åˆ†é¡ç³»çµ±ï¼šé€é AI å½±åƒè¾¨è­˜å”åŠ©åˆ¤æ–·ç´™é¡ã€å¡‘è† ã€é‡‘å±¬ã€ç»ç’ƒã€ç´™é¤å…·èˆ‡ä¸€èˆ¬åƒåœ¾ï¼Œé©åˆç’°å¢ƒæ•™è‚²ã€æ•™å­¸ç¤ºç¯„èˆ‡ AI å°ˆé¡Œå±•ç¤ºçš„äº’å‹•å¼åƒåœ¾åˆ†é¡ç¶²ç«™ã€‚">
<meta name="keywords" content="æ™ºæ…§åƒåœ¾åˆ†é¡ç³»çµ±, AIåƒåœ¾åˆ†é¡, åƒåœ¾å½±åƒè¾¨è­˜, æ™ºèƒ½åˆ†é¡, AIå°ˆé¡Œ, ç’°å¢ƒæ•™è‚², Smart Trash AI">
<meta name="robots" content="index, follow">
<meta name="author" content="Smart Trash AI">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ç³»çµ±é¢¨æ ¼*/
* { box-sizing: border-box; }
body {
  font-family: "Noto Sans TC", sans-serif;
  background: #e8f5e9;
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  height: 100vh;
  overflow-x: hidden;
}

/* å°é¢é  */
#cover {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  background: linear-gradient(135deg, #d0f8ce, #c8e6c9);
  z-index: 3;
  animation: fadeIn 1s ease forwards;
}

#cover img {
  width: 260px;
  margin-bottom: 20px;
  filter: drop-shadow(0 0 12px rgba(76,175,80,0.5));
  animation: float 3s ease-in-out infinite;
}

/*å°é¢æŒ‰éˆ• */
.cover-btn {
  width: 230px;
  padding: 16px 0;
  margin-top: 10px;
  font-size: 1.25rem;
  font-weight: bold;
  border-radius: 40px;
  cursor: pointer;
  transition: 0.28s;
  box-shadow: 0 5px 12px rgba(0,0,0,0.15);
  border: none;
}

/* ä¸»æŒ‰éˆ•ï¼ˆç¶ è‰²ï¼‰ */
.cover-btn.primary {
  background: #66bb6a;
  color: white;
}
.cover-btn.primary:hover {
  background: #57a65c;
  transform: translateY(-3px);
}

/* æ¬¡æŒ‰éˆ•ï¼ˆç™½åº•ç¶ æ¡†ï¼‰ */
.cover-btn.secondary {
  background: white;
  color: #388e3c;
  border: 3px solid #66bb6a;
}
.cover-btn.secondary:hover {
  background: #f1f8f1;
  transform: translateY(-3px);
}

/* ä¸»ç•«é¢ */
#main {
  width: 100%;
  max-width: 480px;
  display: none;
  flex-direction: column;
  align-items: center;
  text-align: center;
}

/* å›ºå®šé ‚éƒ¨æ¨™é¡Œ */
#header {
  width: 100%;
  background: #66bb6a;
  color: white;
  text-align: center;
  font-size: 1.6rem;
  font-weight: bold;
  padding: 14px 0;
  position: fixed;
  top: 0;
  z-index: 5;
  box-shadow: 0 3px 10px rgba(0,0,0,0.2);
}

/* æ”å½±æ©Ÿå€ */
#cameraBox {
  margin-top: 80px;
  background: white;
  padding: 10px 10px 16px;
  border-radius: 16px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
}
video {
  border-radius: 14px;
  width: 300px;
}

/* æ‹ç…§æŒ‰éˆ•ï¼ˆåœ“å½¢ï¼‰ */
#snap {
  width: 80px;
  height: 80px;
  background: #81c784;
  border-radius: 50%;
  border: none;
  margin-top: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25);
  font-size: 1.1rem;
  color: white;
  cursor: pointer;
}
#snap:active { transform: scale(0.9); }

/* åˆ†é¡å­—å¡ï¼ˆç¸®å°ç‰ˆï¼‰ */
#resultCard {
  margin-top: 15px;
  background: white;
  width: 85%;
  max-width: 300px;
  border-radius: 14px;
  padding: 14px;
  text-align: center;
  display: none;
  font-size: 1rem;
  font-weight: bold;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
}
.recycle { border-left: 8px solid #66bb6a; }
.trash   { border-left: 8px solid #9e9e9e; }
.hazard  { border-left: 8px solid #e57373; }

/* å°æç¤ºå¡ */
#tip {
  margin-top: 8px;
  background: #f1f8e9;
  padding: 10px 14px;
  border-radius: 14px;
  display: none;
  width: 85%;
  max-width: 300px;
  border-left: 5px solid #81c784;
  color: #33691e;
  font-size: 0.9rem;
  line-height: 1.5;
}

/* å›é¦–é æŒ‰éˆ• */
#backHome {
  margin-top: 12px;
  background: #a5d6a7;
  color: #1b5e20;
  border: none;
  padding: 10px 24px;
  font-size: 1rem;
  font-weight: bold;
  border-radius: 22px;
  cursor: pointer;
  box-shadow: 0 3px 8px rgba(0,0,0,0.15);
}
#backHome:hover { background: #81c784; transform: translateY(-2px); }

/* å‹•ç•« */
@keyframes fadeIn { from{opacity:0;} to{opacity:1;} }
@keyframes float { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-8px);} }
</style>
</head>

<body>

<h1 style="display:none;">æ™ºæ…§åƒåœ¾åˆ†é¡ç³»çµ± AI åƒåœ¾è¾¨è­˜</h1>

<!-- å°é¢ -->
<div id="cover">
  <!-- LOGO ç…§èˆŠæ”¾åœ¨ model/LOGO.png -->
  <img src="model/LOGO.png" alt="LOGO">

  <!-- ä¸»æŒ‰éˆ•ï¼šé€²å…¥ç³»çµ± -->
  <button class="cover-btn primary" onclick="enterSystem()">è¾¨è­˜ç³»çµ±</button>

  <!-- æ¬¡æŒ‰éˆ•ï¼šåˆ†é¡å°çŸ¥è­˜ -->
  <button class="cover-btn secondary" onclick="location.href='knowledge.html'">
    åˆ†é¡å°çŸ¥è­˜
  </button>

  <!-- æ¬¡æŒ‰éˆ•ï¼šåƒåœ¾æ¸›é‡ Tips -->
  <button class="cover-btn secondary" onclick="location.href='reduce.html'">
    åƒåœ¾æ¸›é‡ Tips
  </button>
</div>

<!-- ä¸»ç•«é¢ -->
<div id="main">
  <div id="header">ğŸŒ æ™ºæ…§åƒåœ¾åˆ†é¡ç³»çµ±</div>

  <div id="cameraBox">
    <video id="video" autoplay playsinline muted></video>
    <button id="snap" disabled>æ‹ç…§</button>
  </div>

  <div id="resultCard"></div>
  <div id="tip"></div>

  <!-- å›é¦–é æŒ‰éˆ• -->
  <button id="backHome" onclick="goHome()">å›é¦–é </button>
</div>

<!-- âœ… åªéœ€è¦ TensorFlow.jsï¼Œä¸å†è¼‰å…¥ Teachable Machine -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>

<script>
const video = document.getElementById('video');
const snapBtn = document.getElementById('snap');
const cover = document.getElementById('cover');
const main = document.getElementById('main');
const resultCard = document.getElementById('resultCard');
const tipBox = document.getElementById('tip');

let model;
let currentStream = null;

/*æ¨¡å‹è¼¸å‡ºé †åº*/
const classNames = ['general', 'paper', 'plastic', 'metal', 'glass', 'foodbox', 'battery'];

/* å°‡è‹±æ–‡é¡åˆ¥è½‰æˆä¸­æ–‡åç¨±ã€UI é¡å‹ã€æç¤ºå°æ‡‰ key */
function mapLabelInfo(labelEn) {
  switch (labelEn) {
    case "plastic":
      return { display: "å¡‘è† é¡", type: "recycle", tipKey: "å¡‘è† é¡" };
    case "paper":
      return { display: "ç´™é¡", type: "recycle", tipKey: "ç´™é¡" };
    case "metal":
      return { display: "é‡‘å±¬é¡", type: "recycle", tipKey: "é‡‘å±¬é¡" };
    case "glass":
      return { display: "ç»ç’ƒé¡", type: "recycle", tipKey: "ç»ç’ƒé¡" };
    case "foodbox":
      return { display: "ç´™é¤å…·", type: "trash", tipKey: "ç´™é¤å…·" };
    case "general":
      return { display: "ä¸€èˆ¬åƒåœ¾", type: "trash", tipKey: "ä¸€èˆ¬åƒåœ¾" };
    case "battery":
      return { display: "æœ‰å®³åƒåœ¾", type: "hazard", tipKey: "æœ‰å®³åƒåœ¾" };
    default:
      return { display: labelEn, type: "trash", tipKey: "" };
  }
}

async function enterSystem() {
  stopCamera();
  cover.style.animation = "fadeOut 1s ease forwards";
  setTimeout(() => {
    cover.style.display = "none";
    main.style.display = "flex";
    loadCameraAndModel();
  }, 900);
}

function backToCover(message) {
  stopCamera();
  main.style.display = "none";
  cover.style.display = "flex";
  alert(message + "\nè«‹å…è¨±ç›¸æ©Ÿå¾Œå†é‡æ–°é»é¸ã€é€²å…¥ç³»çµ±ã€ã€‚");
  setTimeout(() => location.reload(), 600);
}

function stopCamera() {
  if (currentStream) {
    currentStream.getTracks().forEach(t => t.stop());
    currentStream = null;
  }
  video.srcObject = null;
}

/* å›é¦–é  */
function goHome() {
  stopCamera();
  main.style.display = "none";
  cover.style.display = "flex";
  cover.style.animation = "fadeIn 0.6s ease";
}

async function loadCameraAndModel() {
  // é–‹ç›¸æ©Ÿ
  try {
    currentStream = await navigator.mediaDevices.getUserMedia({ video:{facingMode:"environment"} });
    video.srcObject = currentStream;
  } catch (err) {
    console.error("ç›¸æ©Ÿå¤±æ•—ï¼š", err);
    backToCover("âš ï¸ ç„¡æ³•é–‹å•Ÿç›¸æ©Ÿæˆ–æœªå…è¨±ç›¸æ©Ÿæ¬Šé™");
    return;
  }

  // é¡¯ç¤ºæ¨¡å‹è¼‰å…¥ä¸­
  resultCard.style.display = "block";
  resultCard.className = "trash";
  resultCard.innerText = "â³ æ¨¡å‹è¼‰å…¥ä¸­...";

  //æ¨¡å‹
  try {
   model = await tf.loadLayersModel(
  "https://pub-8a57ae65bc8147078e78fa4e3d940303.r2.dev/model.json"
);

    snapBtn.disabled = false;
    resultCard.className = "recycle";
    resultCard.innerText = "âœ… æ¨¡å‹è¼‰å…¥å®Œæˆï¼Œå¯ä»¥é–‹å§‹æ‹ç…§åˆ†é¡ï¼";
    console.log("æ¨¡å‹è¼‰å…¥å®Œæˆ");
  } catch (err) {
    console.error("æ¨¡å‹å¤±æ•—ï¼š", err);
    backToCover("âŒ æ¨¡å‹è¼‰å…¥å¤±æ•—");
  }
}

const tips = {
  "å¡‘è† é¡": "ğŸ’¡ å¦‚æœå®¹å™¨å…§æœ‰æ¶²é«”è¨˜å¾—å…ˆå€’æ‰å–”ï¼",
  "ç´™é¡": "ğŸ§» ç´™å¼µä¿æŒä¹¾ç‡¥ï¼Œé¿å…æ²¹æ±¡èˆ‡å¡‘è† è†œã€‚",
  "é‡‘å±¬é¡": "ğŸ”§ éµé‹ç½å£“æ‰å¾Œå†å›æ”¶ï¼Œå¯ç¯€çœç©ºé–“ã€‚",
  "ç»ç’ƒé¡": "ğŸ¾ ç ´æç»ç’ƒè«‹ç”¨ç´™åŒ…å¥½å†æŠ•å…¥ã€‚",
  "ç´™é¤å…·": "ğŸ½ï¸ è‹¥ç´™é¤å…·æ²¾æ²¹æ±¡ï¼Œè«‹ä¸Ÿä¸€èˆ¬åƒåœ¾ã€‚",
  "ä¸€èˆ¬åƒåœ¾": "ğŸš® ç¢ºèªç„¡å…¶ä»–å¯å›æ”¶éƒ¨åˆ†å³å¯ç›´æ¥ä¸Ÿæ£„åƒåœ¾æ¡¶ã€‚",
  "æœ‰å®³åƒåœ¾": "â˜ ï¸ é›»æ± ã€ç‡ˆç®¡ç­‰éœ€ç‰¹åˆ¥å›æ”¶è™•ç†ã€‚"
};

snapBtn.addEventListener("click", async () => {
  const canvas = document.createElement("canvas");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  const ctx = canvas.getContext("2d");
  ctx.drawImage(video, 0, 0);

  tipBox.style.display = "none";

  try {
    const imgSize = 224; // è¦è·Ÿè¨“ç·´æ™‚ä¸€è‡´
    let tensor = tf.browser.fromPixels(canvas)
      .resizeBilinear([imgSize, imgSize])
      .toFloat()
      .div(255.0)
      .expandDims(0); // [1,224,224,3]

    const prediction = model.predict(tensor);
    const data = await prediction.data();

    // ç”¨å®Œé‡‹æ”¾è¨˜æ†¶é«”
    tensor.dispose();
    prediction.dispose();

    // æ‰¾å‡ºæœ€å¤§æ©Ÿç‡
    let maxIndex = 0;
    let maxProb = data[0];
    for (let i = 1; i < data.length; i++) {
      if (data[i] > maxProb) {
        maxProb = data[i];
        maxIndex = i;
      }
    }

    const labelEn = classNames[maxIndex];
    const info = mapLabelInfo(labelEn);
    const probText = (maxProb * 100).toFixed(2) + "%";

    // è¨­å®š UI æ¨£å¼èˆ‡ icon
    let cssClass = "trash";
    let icon = "ğŸ—‘ï¸";
    if (info.type === "recycle") {
      cssClass = "recycle";
      icon = "â™»ï¸";
    } else if (info.type === "hazard") {
      cssClass = "hazard";
      icon = "â˜ ï¸";
    }

    resultCard.className = cssClass;
    resultCard.style.display = "block";
    resultCard.innerHTML = `${icon}<br><b>${info.display}</b><br><small>${probText}</small>`;

    if (info.tipKey && tips[info.tipKey]) {
      tipBox.innerText = tips[info.tipKey];
      tipBox.style.display = "block";
    }

  } catch (err) {
    console.error("è¾¨è­˜éŒ¯èª¤ï¼š", err);
    resultCard.className = "hazard";
    resultCard.innerText = "âš ï¸ åˆ†é¡éŒ¯èª¤ï¼š" + err.message;
  }
});
</script>
</body>
</html>








