<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">

<!-- åŸºæœ¬ SEO -->
<title>æ™ºæ…§åƒåœ¾åˆ†é¡ç³»çµ±ï½œSmart Trash AI</title>
<meta name="description" content="æ™ºæ…§åƒåœ¾åˆ†é¡ç³»çµ±ï¼šé€é AI å½±åƒè¾¨è­˜å”åŠ©åˆ¤æ–·ç´™é¡ã€å¡‘è† ã€é‡‘å±¬ã€ç»ç’ƒã€ç´™é¤å…·èˆ‡ä¸€èˆ¬åƒåœ¾ï¼Œé©åˆç’°å¢ƒæ•™è‚²ã€æ•™å­¸ç¤ºç¯„èˆ‡ AI å°ˆé¡Œå±•ç¤ºçš„äº’å‹•å¼åƒåœ¾åˆ†é¡ç¶²ç«™ã€‚">
<meta name="keywords" content="æ™ºæ…§åƒåœ¾åˆ†é¡ç³»çµ±, AIåƒåœ¾åˆ†é¡, åƒåœ¾å½±åƒè¾¨è­˜, æ™ºèƒ½åˆ†é¡, AIå°ˆé¡Œ, ç’°å¢ƒæ•™è‚², Smart Trash AI">
<meta name="robots" content="index, follow">
<meta name="author" content="Smart Trash AI">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ç³»çµ±é¢¨æ ¼*/
* { box-sizing: border-box; }
body {
  font-family: "Noto Sans TC", sans-serif;
  background: #e8f5e9;
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  height: 100vh;
  overflow-x: hidden;
}

/* å°é¢é  */
#cover {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  background: linear-gradient(135deg, #d0f8ce, #c8e6c9);
  z-index: 3;
  animation: fadeIn 1s ease forwards;
}

#cover img {
  width: 260px;
  margin-bottom: 20px;
  filter: drop-shadow(0 0 12px rgba(76,175,80,0.5));
  animation: float 3s ease-in-out infinite;
}

/*å°é¢æŒ‰éˆ• */
.cover-btn {
  width: 230px;
  padding: 16px 0;
  margin-top: 10px;
  font-size: 1.25rem;
  font-weight: bold;
  border-radius: 40px;
  cursor: pointer;
  transition: 0.28s;
  box-shadow: 0 5px 12px rgba(0,0,0,0.15);
  border: none;
}

/* ä¸»æŒ‰éˆ•ï¼ˆç¶ è‰²ï¼‰ */
.cover-btn.primary {
  background: #66bb6a;
  color: white;
}
.cover-btn.primary:hover {
  background: #57a65c;
  transform: translateY(-3px);
}

/* æ¬¡æŒ‰éˆ•ï¼ˆç™½åº•ç¶ æ¡†ï¼‰ */
.cover-btn.secondary {
  background: white;
  color: #388e3c;
  border: 3px solid #66bb6a;
}
.cover-btn.secondary:hover {
  background: #f1f8f1;
  transform: translateY(-3px);
}

/* ä¸»ç•«é¢ */
#main {
  width: 100%;
  max-width: 480px;
  display: none;
  flex-direction: column;
  align-items: center;
  text-align: center;
}

/* å›ºå®šé ‚éƒ¨æ¨™é¡Œ */
#header {
  width: 100%;
  background: #66bb6a;
  color: white;
  text-align: center;
  font-size: 1.6rem;
  font-weight: bold;
  padding: 14px 0;
  position: fixed;
  top: 0;
  z-index: 5;
  box-shadow: 0 3px 10px rgba(0,0,0,0.2);
}

/* æ”å½±æ©Ÿå€ */
#cameraBox {
  margin-top: 80px;
  background: white;
  padding: 10px 10px 16px;
  border-radius: 16px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
}
video {
  border-radius: 14px;
  width: 300px;
}

/* æ‹ç…§æŒ‰éˆ•ï¼ˆåœ“å½¢ï¼‰ */
#snap {
  width: 80px;
  height: 80px;
  background: #81c784;
  border-radius: 50%;
  border: none;
  margin-top: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25);
  font-size: 1.1rem;
  color: white;
  cursor: pointer;
}
#snap:active { transform: scale(0.9); }

/* åˆ†é¡å­—å¡ï¼ˆç¸®å°ç‰ˆï¼‰ */
#resultCard {
  margin-top: 15px;
  background: white;
  width: 85%;
  max-width: 300px;
  border-radius: 14px;
  padding: 14px;
  text-align: center;
  display: none;
  font-size: 1rem;
  font-weight: bold;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
}
.recycle { border-left: 8px solid #66bb6a; }
.trash   { border-left: 8px solid #9e9e9e; }
.hazard  { border-left: 8px solid #e57373; }
  /* ã€æ–°å¢ã€‘ä¸ƒé¡åƒåœ¾å°ˆå±¬é¡è‰² */
.paper   { border-left: 8px solid #42a5f5; } /* ç´™é¡ */
.plastic { border-left: 8px solid #1e88e5; } /* å¡‘è†  */
.metal   { border-left: 8px solid #b0bec5; } /* é‡‘å±¬ */
.glass   { border-left: 8px solid #26a69a; } /* ç»ç’ƒ */
.foodbox { border-left: 8px solid #8d6e63; } /* ç´™é¤å…· */


/* å°æç¤ºå¡ */
#tip {
  margin-top: 8px;
  background: #f1f8e9;
  padding: 10px 14px;
  border-radius: 14px;
  display: none;
  width: 85%;
  max-width: 300px;
  border-left: 5px solid #81c784;
  color: #33691e;
  font-size: 0.9rem;
  line-height: 1.5;
}

/* å›é¦–é æŒ‰éˆ• */
#backHome {
  margin-top: 12px;
  background: #a5d6a7;
  color: #1b5e20;
  border: none;
  padding: 10px 24px;
  font-size: 1rem;
  font-weight: bold;
  border-radius: 22px;
  cursor: pointer;
  box-shadow: 0 3px 8px rgba(0,0,0,0.15);
}
#backHome:hover { background: #81c784; transform: translateY(-2px); }

/* å‹•ç•« */
@keyframes fadeIn { from{opacity:0;} to{opacity:1;} }
@keyframes float { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-8px);} }
</style>
</head>

<body>

<h1 style="display:none;">æ™ºæ…§åƒåœ¾åˆ†é¡ç³»çµ± AI åƒåœ¾è¾¨è­˜</h1>

<!-- å°é¢ -->
<div id="cover">
  <img src="model/LOGO.png" alt="LOGO">
  <button class="cover-btn primary" onclick="enterSystem()">è¾¨è­˜ç³»çµ±</button>
  <button class="cover-btn secondary" onclick="location.href='knowledge.html'">
    åˆ†é¡å°çŸ¥è­˜
  </button>
  <button class="cover-btn secondary" onclick="location.href='reduce.html'">
    åƒåœ¾æ¸›é‡ Tips
  </button>
</div>

<!-- ä¸»ç•«é¢ -->
<div id="main">
  <div id="header">ğŸŒ æ™ºæ…§åƒåœ¾åˆ†é¡ç³»çµ±</div>

  <div id="cameraBox">
    <video id="video" autoplay playsinline muted></video>
    <button id="snap" disabled>æ‹ç…§</button>
  </div>

  <div id="resultCard"></div>
  <div id="tip"></div>

  <button id="backHome" onclick="goHome()">å›é¦–é </button>
</div>

<!-- TensorFlow.jsï¼ˆå»ºè­°ä½¿ç”¨æœ€æ–°ç‰ˆ 4.xï¼‰ -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.22.0/dist/tf.min.js"></script>

<script>
const video = document.getElementById('video');
const snapBtn = document.getElementById('snap');
const cover = document.getElementById('cover');
const main = document.getElementById('main');
const resultCard = document.getElementById('resultCard');
const tipBox = document.getElementById('tip');

// ä¾‹ï¼šä½ çš„ R2 å…¬é–‹ç¶²å€é•·å¾—åƒé€™æ¨£ï¼Œå°±ç…§è‡ªå·±çš„æ”¹
const MODEL_URL  = "https://pub-3ec94e6b58164b2e8f0137fc44c63dab.r2.dev/model.json";
const LABELS_URL = "https://pub-3ec94e6b58164b2e8f0137fc44c63dab.r2.dev/labels.json";
const MODEL_URL  = "https://09286b14de87cde768a2a20aa2505e08.r2.cloudflarestorage.com/model/model.json";
const LABELS_URL = "https://09286b14de87cde768a2a20aa2505e08.r2.cloudflarestorage.com/model/labels.json";


let model = null;
let labels = [];       // ç”± labels.json è¼‰å…¥
let currentStream = null;

/* ä¾ã€Œä¸­æ–‡é¡åˆ¥åç¨±ã€å°æ‡‰ UI é¡å‹èˆ‡æç¤º key
   labels.json è£¡å»ºè­°æ˜¯ï¼š
   ["ä¸€èˆ¬åƒåœ¾","ç´™é¡","å¡‘è† ","é‡‘å±¬","ç»ç’ƒ","ç´™é¤å…·","æœ‰å®³åƒåœ¾"]
*/
function mapLabelInfo(labelZh) {
  switch (labelZh) {
    case "ä¸€èˆ¬åƒåœ¾":
      return { display: "ä¸€èˆ¬åƒåœ¾", css: "trash", icon: "ğŸ—‘ï¸", tipKey: "ä¸€èˆ¬åƒåœ¾" };
    case "ç´™é¡":
      return { display: "ç´™é¡", css: "paper", icon: "ğŸ“„", tipKey: "ç´™é¡" };
    case "å¡‘è† ":
      return { display: "å¡‘è† ", css: "plastic", icon: "ğŸ§´", tipKey: "å¡‘è† é¡" };
    case "é‡‘å±¬":
      return { display: "é‡‘å±¬", css: "metal", icon: "ğŸ¥«", tipKey: "é‡‘å±¬é¡" };
    case "ç»ç’ƒ":
      return { display: "ç»ç’ƒ", css: "glass", icon: "ğŸ¾", tipKey: "ç»ç’ƒé¡" };
    case "ç´™é¤å…·":
      return { display: "ç´™é¤å…·", css: "foodbox", icon: "ğŸ±", tipKey: "ç´™é¤å…·" };
    case "æœ‰å®³åƒåœ¾":
      return { display: "æœ‰å®³åƒåœ¾", css: "hazard", icon: "â˜ ï¸", tipKey: "æœ‰å®³åƒåœ¾" };
    default:
      return { display: labelZh || "æœªçŸ¥é¡åˆ¥", css: "trash", icon: "â“", tipKey: "" };
  }
}

async function enterSystem() {
  stopCamera();
  cover.style.animation = "fadeOut 1s ease forwards";
  setTimeout(() => {
    cover.style.display = "none";
    main.style.display = "flex";
    loadCameraAndModel();
  }, 900);
}

function backToCover(message) {
  stopCamera();
  main.style.display = "none";
  cover.style.display = "flex";
  alert(message + "\nè«‹å…è¨±ç›¸æ©Ÿå¾Œå†é‡æ–°é»é¸ã€è¾¨è­˜ç³»çµ±ã€ã€‚");
  setTimeout(() => location.reload(), 600);
}

function stopCamera() {
  if (currentStream) {
    currentStream.getTracks().forEach(t => t.stop());
    currentStream = null;
  }
  video.srcObject = null;
}

/* å›é¦–é  */
function goHome() {
  stopCamera();
  main.style.display = "none";
  cover.style.display = "flex";
  cover.style.animation = "fadeIn 0.6s ease";
}

/* é–‹ç›¸æ©Ÿ + è¼‰å…¥æ¨¡å‹ */
async function loadCameraAndModel() {
  // å…ˆé–‹ç›¸æ©Ÿ
  try {
    currentStream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: "environment" },
      audio: false
    });
    video.srcObject = currentStream;
  } catch (err) {
    console.error("ç›¸æ©Ÿå•Ÿå‹•å¤±æ•—ï¼š", err);
    backToCover("ç›¸æ©Ÿå•Ÿå‹•å¤±æ•—");
    return;
  }

  // é¡¯ç¤ºæ¨¡å‹è¼‰å…¥ä¸­
  resultCard.style.display = "block";
  resultCard.className = "trash";
  resultCard.innerText = "â³ æ¨¡å‹è¼‰å…¥ä¸­â€¦";

  try {
    // 1. è¼‰å…¥ TFJS æ¨¡å‹
    model = await tf.loadLayersModel(MODEL_URL);

    // 2. è¼‰å…¥é¡åˆ¥åç¨±ï¼ˆlabels.jsonï¼‰
    try {
      const res = await fetch(LABELS_URL);
      labels = await res.json();
      console.log("labels.json å…§å®¹ï¼š", labels);
    } catch (e) {
      console.warn("labels.json è¼‰å…¥å¤±æ•—ï¼Œå°‡ä½¿ç”¨ç´¢å¼•é¡¯ç¤ºé¡åˆ¥ï¼š", e);
      labels = [];
    }

    snapBtn.disabled = false;
    resultCard.className = "recycle";
    resultCard.innerText = "âœ… æ¨¡å‹è¼‰å…¥å®Œæˆï¼Œå¯ä»¥é–‹å§‹æ‹ç…§åˆ†é¡ï¼";
    console.log("æ¨¡å‹è¼‰å…¥å®Œæˆ");
  } catch (err) {
    console.error("æ¨¡å‹è¼‰å…¥å¤±æ•—ï¼š", err);
    backToCover("âŒ æ¨¡å‹è¼‰å…¥å¤±æ•—");
  }
}

/* å°æç¤ºå…§å®¹ */
const tips = {
  "ä¸€èˆ¬åƒåœ¾": "ğŸš® ç¢ºèªç„¡å…¶ä»–å¯å›æ”¶éƒ¨åˆ†å³å¯ç›´æ¥ä¸Ÿæ£„åƒåœ¾æ¡¶ã€‚",
  "ç´™é¡":   "ğŸ§» ç´™å¼µä¿æŒä¹¾ç‡¥ï¼Œé¿å…æ²¹æ±¡èˆ‡å¡‘è† è†œã€‚",
  "å¡‘è† é¡": "ğŸ’¡ å¦‚æœå®¹å™¨å…§æœ‰æ¶²é«”è¨˜å¾—å…ˆå€’æ‰å–”ï¼",
  "é‡‘å±¬é¡": "ğŸ”§ éµé‹ç½å£“æ‰å¾Œå†å›æ”¶ï¼Œå¯ç¯€çœç©ºé–“ã€‚",
  "ç»ç’ƒé¡": "ğŸ¾ ç ´æç»ç’ƒè«‹ç”¨ç´™åŒ…å¥½å†æŠ•å…¥ã€‚",
  "ç´™é¤å…·": "ğŸ½ï¸ è‹¥ç´™é¤å…·æ²¾æ²¹æ±¡ï¼Œè«‹ä¸Ÿä¸€èˆ¬åƒåœ¾ã€‚",
  "æœ‰å®³åƒåœ¾": "â˜ ï¸ é›»æ± ã€ç‡ˆç®¡ç­‰éœ€ç‰¹åˆ¥å›æ”¶è™•ç†ã€‚"
};

/* æ‹ç…§ä¸¦é€å…¥æ¨¡å‹é æ¸¬ */
snapBtn.addEventListener("click", async () => {
  const canvas = document.createElement("canvas");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  const ctx = canvas.getContext("2d");
  ctx.drawImage(video, 0, 0);

  tipBox.style.display = "none";

  try {
    const imgSize = 224; // è¦è·Ÿè¨“ç·´æ™‚ä¸€è‡´
    let tensor = tf.browser.fromPixels(canvas)
      .resizeBilinear([imgSize, imgSize])
      .toFloat()
      .expandDims(0); // [1,224,224,3]

    const prediction = model.predict(tensor);
    const data = await prediction.data();

    tensor.dispose();
    prediction.dispose();

    // æ‰¾å‡ºæœ€å¤§æ©Ÿç‡
    let maxIndex = 0;
    let maxProb = data[0];
    for (let i = 1; i < data.length; i++) {
      if (data[i] > maxProb) {
        maxProb = data[i];
        maxIndex = i;
      }
    }

    const labelZh = labels[maxIndex] || `é¡åˆ¥ ${maxIndex}`;
    const info = mapLabelInfo(labelZh);
    const probText = (maxProb * 100).toFixed(2) + "%";

    const cssClass = info.css;
const icon = info.icon;


    resultCard.className = cssClass;
    resultCard.style.display = "block";
    resultCard.innerHTML = `${icon}<br><b>${info.display}</b><br><small>${probText}</small>`;

    if (info.tipKey && tips[info.tipKey]) {
      tipBox.innerText = tips[info.tipKey];
      tipBox.style.display = "block";
    }

  } catch (err) {
    console.error("è¾¨è­˜éŒ¯èª¤ï¼š", err);
    resultCard.className = "hazard";
    resultCard.style.display = "block";
    resultCard.innerText = "âš ï¸ åˆ†é¡éŒ¯èª¤ï¼š" + err.message;
  }
});
</script>
</body>
</html>




